---
title: "Lab 06 - Ugly charts and Simpson's paradox"
author: "Anaelle Gackiere"
date: "02-20-2026"
output: github_document
---

### Load packages and data

```{r load-packages, message = FALSE}
library(tidyverse) 
library(dsbox)
library(mosaicData) 
```

```{r prep}

data(Whickham)

?Whickham
```

### Exercise 1

This is an observational study, because the data comes from a survey that asks for their smoking status, age, and then the survival status is measured 20 years after, but no manipulation of variables is present. As the data description describes, "Data on age, smoking, and mortality from a one-in-six survey of the electoral roll in Whickham [...] the survey was conducted in 1972-1974 to study heart disease and thyroid disease. A follow-up on those in the survey was conducted twenty years later."

### Exercise 2

How many observations are in this dataset? What does each observation represent?

There are 1314 observations on women, each of which has their age, smoking status at baseline, and survival status.

### Exercise 3

How many variables are in this dataset? What type of variable is each? Display each variable using an appropriate visualization.

There are three variables in this data set (age, smoker, outcome). The outcome variable is a factor with two levels: Alive and Dead. The smoker variable is a factor with two levels: No and Yes. The age variable is a continuous one, and it is classified as an integer.

```{r display-vars}
# class check
class(Whickham$age)
class(Whickham$outcome)
class(Whickham$smoker)

# display age
ggplot(Whickham, aes(age)) +
  geom_histogram(fill = "plum") +
  labs(title = "Age of Women in the Whickham Data Frame",
       y = "Proportion",
       x = "Age") +
  theme_linedraw()

# display smoker
ggplot(Whickham, aes(x = smoker, fill = smoker)) +
  geom_bar() +
  labs(title = "Smoker Status of Women in the Whickham Data Frame",
       y = "Proportion",
       x = "Smoker") +
  scale_fill_manual(values = c("Yes" = "plum", "No" = "plum4")) +
  theme_linedraw()

# display outcome
ggplot(Whickham, aes(x = outcome, fill = outcome)) +
  geom_bar() +
  labs(y = "Proportion",
       x = "Outcome",
       title = "Outcomes of Women in the Whickham Data Frame") +
  scale_fill_manual(values = c("Alive" = "plum", "Dead" = "plum4")) +
  theme_linedraw()

```

...

### Exercise 4

What would you expect the relationship between smoking status and health outcome to be?

I would expect yes in the smoking status would be positively associated with Dead in the outcome.

### Exercise 5

I did not expect to see that more women who did NOT smoke died, compared to women who smoked.

```{r visual}
# visual
ggplot(Whickham, aes(x = smoker, fill = outcome)) +
  geom_bar(position = "fill") +
  labs(y = "Proportion",
       x = "Smoking Status",
       title = "Smoking Status vs. Outcomes") +
  scale_fill_manual(values = c("Alive" = "plum", "Dead" = "plum4")) +
  theme_linedraw()

# calculate proportions and make a table of it
Whickham %>%
  count(smoker, outcome) %>%
  group_by(smoker) %>%
  mutate(prop = n / sum(n))


```

...

### Exercise 6

```{r new-var}

# new age variable (categories)
Whickham <- Whickham %>%
  mutate(age_cat = case_when(
    age <= 44 ~ "18-44",
    age > 44 & age <= 64 ~ "45-64",
    age > 64 ~ "65+"
  ))
# check it worked 
head(Whickham$age_cat)

```

### Exercise 7

Now that we take age into consideration, the outcome is what I predicted: out of women who died, there were more of them who smoked than those who did not. As age increases, so does the proportion of people who die, and the proportion of women who smoke and died is greater than the proportion of women who did not smoke and died for all age groups.

```{r new-visual}

# visual 
ggplot(Whickham, aes(x = smoker, fill = outcome)) +
  geom_bar(position = "fill") +
  facet_wrap(vars(age_cat)) +
  labs(y = "Proportion") +
  scale_fill_manual(values = c("Alive" = "plum", "Dead" = "plum4")) +
  theme_linedraw()

# contingency table
Whickham %>%
  count(age_cat, smoker, outcome) %>%
  group_by(age_cat, smoker) %>%
  mutate(prop = n / sum(n))

```
